---
import {
  format,
  eachDayOfInterval,
  startOfMonth,
  endOfMonth,
  getDay,
} from "date-fns";
import SocialLinksInline from "./SocialLinksInline.astro";

const currentYear = new Date().getFullYear();
const months = ["April", "May", "June", "July", "August", "September"];
const volunteerEventDates: Date[] = [];

const isVolunteerEventDate = (date: Date) => {
  return volunteerEventDates.some(
    (eventDate) =>
      eventDate.getDate() === date.getDate() &&
      eventDate.getMonth() === date.getMonth() &&
      eventDate.getFullYear() === date.getFullYear(),
  );
};

const getDaysInMonth = (year: number, month: number) => {
  const start = startOfMonth(new Date(year, month));
  const end = endOfMonth(start);
  return eachDayOfInterval({ start, end });
};
---

<div
  class="calendar-container mx-auto max-w-(--breakpoint-2xl) px-4 sm:px-6 lg:px-8 py-12"
>
  <div class="mb-12 flex flex-col md:flex-row justify-between items-end gap-8">
    <div>
      <div class="flex items-center gap-4 mb-4">
        <span class="inline-block h-px w-8 bg-primary-dark"></span>
        <span
          class="font-mono text-[10px] font-black uppercase tracking-[0.2em] text-stone-500"
          >Field Schedule</span
        >
      </div>
      <h2
        class="text-4xl sm:text-6xl font-serif font-black uppercase tracking-tight text-stone-900 leading-none"
      >
        Volunteer <span class="text-primary-dark italic">Calendar.</span>
      </h2>
    </div>
    <div class="max-w-md">
      <p class="text-sm font-medium text-stone-500 leading-relaxed">
        <span
          class="font-mono text-[10px] font-black uppercase tracking-widest text-primary-dark block mb-2"
          >Notice: Seasonal Operations</span
        >
        Official volunteer events are scheduled from April through September. Priority
        registration reminders are dispatched via the command network.
      </p>
    </div>
  </div>

  <div
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-px bg-stone-300 border border-stone-300"
  >
    {
      months.map((month, index) => {
        const monthIndex = index + 3; // April is index 3
        const daysInMonth = getDaysInMonth(currentYear, monthIndex);
        const firstDayOfWeek = getDay(daysInMonth[0]);

        return (
          <div class="bg-white p-8">
            <h3 class="mb-6 font-serif font-black uppercase text-xl text-stone-900 border-b border-stone-100 pb-2">
              {month}
            </h3>
            <div class="grid grid-cols-7 gap-px bg-stone-100 border border-stone-100">
              {["S", "M", "T", "W", "T", "F", "S"].map((day) => (
                <div class="bg-stone-50 py-2 text-center font-mono text-[10px] font-black uppercase text-stone-500">
                  {day}
                </div>
              ))}
              {Array.from({ length: firstDayOfWeek }).map((_) => (
                <div class="bg-white h-10" />
              ))}
              {daysInMonth.map((day) => (
                <div
                  class={`relative flex h-10 items-center justify-center bg-white ${isVolunteerEventDate(day) ? "bg-primary/5" : ""}`}
                >
                  <span
                    class={`font-mono text-xs ${isVolunteerEventDate(day) ? "font-black text-primary-dark" : "text-stone-600"}`}
                  >
                    {format(day, "d")}
                  </span>
                  {isVolunteerEventDate(day) && (
                    <div class="absolute inset-0 border-2 border-primary-dark/20" />
                  )}
                </div>
              ))}
              {/* Fill remaining cells */}
              {Array.from({
                length: (7 - ((daysInMonth.length + firstDayOfWeek) % 7)) % 7,
              }).map((_) => (
                <div class="bg-white h-10" />
              ))}
            </div>
          </div>
        );
      })
    }
  </div>
</div>

<style>
  @font-face {
    font-family: "EditorialSerif";
    src: local("Georgia"), local("Times New Roman"), serif;
  }
  .font-serif {
    font-family: "EditorialSerif", serif;
  }
</style>
