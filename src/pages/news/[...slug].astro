---
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { Picture } from 'astro:assets';

export async function getStaticPaths() {
  const newsEntries = await getCollection('news');
  return newsEntries.map((entry) => ({
    params: { slug: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);
---

<Layout title={entry.data.title}>
  <main class="bg-stone-50 text-stone-900">
    <!-- News Header -->
    <section class="border-b border-stone-300">
      <div
        class="mx-auto max-w-(--breakpoint-2xl) px-4 sm:px-6 lg:px-8 py-16 lg:py-24"
      >
        <div class="flex items-center gap-4 mb-8">
          <span class="inline-block h-px w-12 bg-primary-dark"></span>
          <span
            class="font-mono text-[10px] font-black tracking-[0.2em] uppercase text-stone-500"
          >
            News
          </span>
        </div>

        <h1
          class="text-5xl sm:text-7xl font-serif font-black uppercase tracking-tighter text-stone-900 text-balance"
        >
          {entry.data.title}
        </h1>

        <div class="mt-6 flex flex-wrap items-center gap-6">
          <span
            class="font-mono text-[10px] font-black uppercase tracking-[0.2em] text-primary-dark"
          >
            Publish Date
          </span>
          <time
            class="font-mono text-xs font-black uppercase tracking-widest text-stone-700"
            datetime={entry.data.publishedOn.toString()}
          >
            {new Intl.DateTimeFormat("en-US", {
              month: "short",
              day: "2-digit",
              year: "numeric",
            }).format(new Date(entry.data.publishedOn))}
          </time>
        </div>
      </div>
    </section>

    <!-- Field Report -->
    <section class="border-b border-stone-300">
      <div
        class="mx-auto max-w-(--breakpoint-2xl) px-4 sm:px-6 lg:px-8 py-16 lg:py-24"
      >
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 items-start">
          <div class="lg:col-span-7">
            <div class="border border-stone-300 bg-white p-4">
              <Picture
                loading="lazy"
                formats={["avif", "webp"]}
                width={1200}
                height={800}
                class="w-full h-auto object-cover"
                src={entry.data.coverImage}
                alt={`${entry.data.title} cover image`}
              />
            </div>
          </div>
          <div class="lg:col-span-5">
            <div class="border border-stone-300 bg-white p-8">
              <div class="flex items-center gap-3 mb-6">
                <span class="inline-block h-px w-8 bg-primary-dark"></span>
                <span
                  class="font-mono text-[10px] font-black uppercase tracking-[0.2em] text-stone-500"
                >
                  Field Notes
                </span>
              </div>
              <div class="prose prose-stone lg:prose-lg max-w-none">
                <Content />
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>
