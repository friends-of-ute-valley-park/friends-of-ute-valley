---
import Layout from "@layouts/Layout.astro";
import VolunteerItem from "@components/VolunteerItem.vue";
import SocialLinks from "@components/SocialLinks.astro";

import { Image } from "astro:assets";

import { getCollection } from "astro:content";
import { isFuture, endOfDay } from "date-fns";
const upcomingVolunteerEvents = await getCollection("events", ({ data }) => {
  return isFuture(endOfDay(new Date(data.date)));
});
const meetingLocations = await getCollection("trailheads");
const links = await getCollection("links");
const wishlist = await getCollection("wishlist", ({ data }) => {
  return data.quantityNeeded > 0;
});
const sortedLinks = links.sort((b, a) => a.data.priority - b.data.priority);

import Logo from "@/assets/images/logos/logo-medium.jpg";
---

<Layout
  title="Link in Bio"
  description="Quick links from Friends of Ute Valley Park including volunteer events, resources, and current wishlist needs."
>
  <main class="bg-stone-50 min-h-screen py-8">
    <div
      class="mx-auto max-w-xl bg-white border border-stone-300 shadow-sm overflow-hidden"
    >
      <!-- Header -->
      <div class="p-8 border-b border-stone-300 bg-stone-50/50">
        <div class="flex flex-col items-center gap-6 text-center">
          <div class="p-1 border border-stone-300 bg-white shadow-sm">
            <Image src={Logo} alt="FUVP Seal" width="80" height="80" class="" />
          </div>
          <div class="space-y-2">
            <h1
              class="text-3xl font-serif font-black uppercase tracking-tighter text-stone-900 leading-none"
            >
              Friends of <br />
              <span class="text-primary-dark">Ute Valley Park.</span>
            </h1>
            <p
              class="font-mono text-[10px] font-black uppercase tracking-[0.2em] text-stone-500"
            >
              Ute Valley Park — Quick Links
            </p>
          </div>
          <div
            class="pt-4 border-t border-stone-200 w-full flex justify-center"
          >
            <SocialLinks />
          </div>
        </div>
      </div>

      <!-- Active Operations -->
      {
        upcomingVolunteerEvents.length > 0 && (
          <div class="p-8 border-b border-stone-300 bg-white">
            <div class="flex items-center gap-3 mb-6">
              <span class="inline-block h-px w-6 bg-accent-dark" />
              <h2 class="font-mono text-[10px] font-black uppercase tracking-widest text-accent-dark">
                Volunteer Opportunities
              </h2>
            </div>
            <div class="space-y-8">
              {upcomingVolunteerEvents.map((volunteerEvent) => (
                <div class="border-l-2 border-stone-100 pl-4">
                  <VolunteerItem
                    meetingLocations={meetingLocations}
                    volunteerEvent={volunteerEvent}
                    client:idle
                  />
                </div>
              ))}
            </div>
          </div>
        )
      }

      <!-- Quick Links -->
      <div class="p-8 border-b border-stone-300 bg-stone-50/30">
        <div class="flex items-center gap-3 mb-6">
          <span class="inline-block h-px w-6 bg-primary-dark"></span>
          <h2
            class="font-mono text-[10px] font-black uppercase tracking-widest text-primary-dark"
          >
            Useful Links
          </h2>
        </div>
        <div class="grid grid-cols-1 gap-4">
          {
            sortedLinks.map((link) => (
              <a
                href={link.data.link}
                target="_blank"
                rel="noopener noreferrer"
                class="group flex justify-between items-center p-5 border border-stone-300 bg-white hover:border-primary-dark transition-all active:scale-[0.98]"
              >
                <span class="font-mono text-xs font-black uppercase tracking-widest text-stone-900 group-hover:text-primary-dark transition-colors">
                  {link.data.title}
                </span>
                <span class="text-stone-300 group-hover:text-primary-dark transition-colors">
                  →
                </span>
              </a>
            ))
          }
        </div>
      </div>

      <!-- Technical Wishlist -->
      <div class="p-8 bg-white">
        <div class="flex items-center gap-3 mb-6">
          <span class="inline-block h-px w-6 bg-stone-400"></span>
          <h2
            class="font-mono text-[10px] font-black uppercase tracking-widest text-stone-500"
          >
            Our Wishlist
          </h2>
        </div>
        <p
          class="text-[10px] font-mono uppercase tracking-tighter text-stone-500 mb-8 leading-relaxed"
        >
          The following items are needed for our work in the park. Please <a
            href="/contact/"
            class="text-primary-dark font-black underline">contact us</a
          > to coordinate delivery.
        </p>

        <div
          class="grid grid-cols-2 gap-px bg-stone-200 border border-stone-200"
        >
          {
            wishlist.map((item) => (
              <div class="bg-white p-4 space-y-4 hover:bg-stone-50 transition-colors group">
                <div class="aspect-square bg-stone-100 border border-stone-100 overflow-hidden relative">
                  <Image
                    src={item.data.image}
                    alt={item.data.imageAlt}
                    width="200"
                    height="200"
                    class="w-full h-full object-cover transition-all duration-700"
                  />
                  <div class="absolute bottom-2 left-2 bg-stone-900 text-white px-2 py-0.5 font-mono text-[8px] uppercase tracking-tighter">
                    {item.data.quantityNeeded} REQUIRED
                  </div>
                </div>
                <div class="space-y-1">
                  <h3 class="font-mono text-[10px] font-black uppercase tracking-tight text-stone-900 group-hover:text-primary-dark transition-colors">
                    <a
                      href={item.data.link}
                      target="_blank"
                      rel="noopener noreferrer"
                    >
                      {item.data.title}
                    </a>
                  </h3>
                </div>
              </div>
            ))
          }
        </div>
      </div>

      <!-- Footer -->
      <div class="p-8 border-t border-stone-300 bg-stone-900 text-center">
        <p
          class="font-mono text-[8px] uppercase tracking-[0.4em] text-stone-500"
        >
          Friends of Ute Valley Park — 2026 Active Wildland
        </p>
      </div>
    </div>
  </main>
</Layout>

<style>
  @font-face {
    font-family: "EditorialSerif";
    src: local("Georgia"), local("Times New Roman"), serif;
  }
  .font-serif {
    font-family: "EditorialSerif", serif;
  }
</style>
