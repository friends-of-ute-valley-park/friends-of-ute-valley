---
import "../styles/global.css";
import { ClientRouter } from "astro:transitions";

import NavigationBar from "@components/NavigationBar.vue";
import NavigationFooter from "@components/NavigationFooter.astro";
import SocialLinks from "@components/SocialLinks.astro";
import VolunteerBanner from "@components/VolunteerBanner.vue";
import DomainChange from "@components/DomainChange.astro";
import "inter-ui/inter.css";

import { getCollection } from "astro:content";
import { isFuture, endOfDay } from "date-fns";
const upcomingVolunteerEvents = await getCollection("events", ({ data }) => {
  return isFuture(endOfDay(new Date(data.date)));
});

export interface Props {
  title: string;
  description?: string;
}

const {
  title,
  description = "Friends of Ute Valley Park is a volunteer-led nonprofit helping protect, restore, and advocate for Ute Valley Park in Colorado Springs.",
} = Astro.props as Props;

const turnstileRoutes = new Set(["/contact/", "/volunteer/"]);
const shouldLoadTurnstile = turnstileRoutes.has(Astro.url.pathname);
---

<!doctype html>
<html lang="en" style="color-scheme: light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="theme-color" content="#fafaf9" />
    <meta name="description" content={description} />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    <link rel="sitemap" href="/sitemap-index.xml" />
    <title>{title} - Friends of Ute Valley Park</title>
    {
      shouldLoadTurnstile && (
        <>
          <link rel="preconnect" href="https://challenges.cloudflare.com" />
          <script
            is:inline
            src="https://challenges.cloudflare.com/turnstile/v0/api.js"
            async
            defer></script>
        </>
      )
    }
  </head>
  <ClientRouter />

  <body
    class="font-sans bg-stone-50 selection:bg-accent/30 selection:text-primary-dark"
  >
    <a
      href="#main-content"
      class="sr-only bg-white text-black underline focus:not-sr-only"
      >Skip to main content</a
    >
    <div class="min-h-screen bg-stone-50">
      <DomainChange />
      <VolunteerBanner
        events={upcomingVolunteerEvents.map((event) => event.data)}
        client:idle
      />
      <NavigationBar page={Astro.url.pathname} client:idle>
        <Fragment slot="social-links">
          <SocialLinks />
        </Fragment>
      </NavigationBar>

      <div id="main-content">
        <!-- Background Grid Effect -->
        <main>
          <slot />
        </main>
      </div>
      <NavigationFooter />
    </div>
  </body>
</html>
